<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.22">
<title>Squashfs Binary Format</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Squashfs Binary Format</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about">1. About</a></li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_packing_file_data">2.1. Packing File Data</a></li>
<li><a href="#_packing_metadata">2.2. Packing Metadata</a></li>
<li><a href="#_storing_lookup_tables">2.3. Storing Lookup Tables</a></li>
<li><a href="#_supported_compressors">2.4. Supported Compressors</a></li>
</ul>
</li>
<li><a href="#_the_superblock">3. The Superblock</a>
<ul class="sectlevel2">
<li><a href="#_compression_options">3.1. Compression Options</a>
<ul class="sectlevel3">
<li><a href="#_gzip">3.1.1. GZIP</a></li>
<li><a href="#_xz">3.1.2. XZ</a></li>
<li><a href="#_lz4">3.1.3. LZ4</a></li>
<li><a href="#_zstd">3.1.4. ZSTD</a></li>
<li><a href="#_lzo">3.1.5. LZO</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_data_and_fragment_blocks">4. Data and Fragment Blocks</a></li>
<li><a href="#_inode_table">5. Inode Table</a>
<ul class="sectlevel2">
<li><a href="#_common_inode_header">5.1. Common Inode Header</a></li>
<li><a href="#_directory_inodes">5.2. Directory Inodes</a></li>
<li><a href="#_file_inodes">5.3. File Inodes</a></li>
<li><a href="#_symbolic_links">5.4. Symbolic Links</a></li>
<li><a href="#_device_special_files">5.5. Device Special Files</a></li>
<li><a href="#_ipc_inodes_fifo_or_socket">5.6. IPC Inodes (FIFO or Socket)</a></li>
</ul>
</li>
<li><a href="#_directory_table">6. Directory Table</a>
<ul class="sectlevel2">
<li><a href="#_directory_index">6.1. Directory Index</a></li>
</ul>
</li>
<li><a href="#_fragment_table">7. Fragment Table</a></li>
<li><a href="#_export_table">8. Export Table</a></li>
<li><a href="#_id_table">9. ID Table</a></li>
<li><a href="#_xattr_table">10. Extended Attribute Table</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_about">1. About</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SquashFS is a compressed, read-only filesystem for Linux that can also be used
as a flexible, general purpose, compressed archive format, optimized for fast
random access with support for Unix permissions, sparse files and extended
attributes.</p>
</div>
<div class="paragraph">
<p>SquashFS supports data and metadata compression through zlib, lz4, lzo, lzma,
xz or zstd.</p>
</div>
<div class="paragraph">
<p>For fast random access, compressed files are split up in fixed size blocks
that are compressed separately.
The block size can be set between 4k and 1M (default for squashfs-tools and
squashfs-tools-ng is 128K).</p>
</div>
<div class="paragraph">
<p>This document attempts to specify the on-disk format in detail.
It is based on a previous on-line version that was originally written by
Zachary Dremann and subsequently expanded by David Oberhollenzer during
reverse engineering attempts and available here: <a href="https://dr-emann.github.io/squashfs/" class="bare">https://dr-emann.github.io/squashfs/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SquashFS always stores integers in little endian format.
The data blocks that make up the SquashFS archive are byte aligned,
i.e.  they typically do not care for alignment.
The implementation in the Linux kernel requires the archive itself to
be a multiple of either 1k or 4k in size (called the device block size)
and user space tools typically use 4k to be compatible with both.</p>
</div>
<div class="paragraph">
<p>A SquashFS archive consists of a maximum of nine parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> _______________
|               |  Important information about the archive, including
|  Superblock   |  locations of other sections.
|_______________|
|               |  If non-default compression options have been used,
|  Compression  |  they can optionally be stored here, to facilitate
|    options    |  later, offline editing of the archive.
|_______________|
|               |
|  Data blocks  |  The contents of the files in the archive,
|  &amp; fragments  |  split into separately compressed blocks.
|_______________|
|               |  Metadata (ownership, permissions, etc) for
|  Inode table  |  items in the archive.
|_______________|
|               |
|   Directory   |  Directory listings, including file names, and
|     table     |  references to inodes.
|_______________|
|               |
|   Fragment    |  Description of fragment locations within the
|    table      |  Datablocks &amp; Fragments section.
|_______________|
|               |  A mapping from inode numbers to disk locations,
| Export table  |  required for NFS export.
|_______________|
|               |
|    UID/GID    |  A list of unique UID/GIDs. Inodes use an index into
|  lookup table |  this table to save memory.
|_______________|
|               |
|     Xattr     |  Extended attributes for items in the archive.
|     table     |
|_______________|</pre>
</div>
</div>
<div class="paragraph">
<p>Although the super block details the exact positions of each section, most
implementations, including the one in the Linux kernel, insist on this exact
order.</p>
</div>
<div class="sect2">
<h3 id="_packing_file_data">2.1. Packing File Data</h3>
<div class="paragraph">
<p>The file data is packed into the archive after the super block (and optional
compressor options).</p>
</div>
<div class="paragraph">
<p>Files are divided into fixed size blocks that are separately compressed and
stored in order. SquashFS supports optional tail-end-packing of files that
are not an exact multiple of the block size. The remaining ends can either
be treated as a short block, or can be packed together with the tail ends of
other files in a single "fragment block". Files that are less than block size
are treated the same way.</p>
</div>
<div class="paragraph">
<p>If the size of a data or fragment block would exceed the input size after
compression, the original, uncompressed data is stored, so that the size of a
block after compression never exceeds the input block size.</p>
</div>
</div>
<div class="sect2">
<h3 id="_packing_metadata">2.2. Packing Metadata</h3>
<div class="paragraph">
<p>Metadata (e.g. inodes, directory listings, etc&#8230;&#8203;) is treated as a continuous
stream of records that is chopped up into 8KiB blocks that are separately
compressed into special metadata blocks.</p>
</div>
<div class="paragraph">
<p>The input size of 8KiB is fixed and independent of the data block size.
Similar to data blocks, if the compressed size would exceed 8KiB, the
uncompressed block is stored instead, so the on-disk size of a metadata
block never exceeds 8KiB.</p>
</div>
<div class="paragraph">
<p>Individual entries are allowed to cross the block boundary, so e.g. an inode
may be located at the end of a metadata block with some part of it located at
the start of the next block. Both have to be read and decompressed when
reading this inode. If an entry is written across block boundaries, there
<strong>MUST NOT</strong> be any gap between the compressed metadata blocks on-disk.</p>
</div>
<div class="paragraph">
<p>In contrast to data blocks, every metadata block is preceded by a single,
16 bit unsigned integer. This integer holds the on-disk size of the block
that follows. The MSB is set if the block is stored uncompressed. Whenever
a metadata block is referenced, the position of this integer is given.</p>
</div>
<div class="paragraph">
<p>To read a metadata block, seek to the indicated position and read the 16 bit
header. Sanity check that the lower 15 bit are less than 8KiB and proceed
to read that many bytes. If the highest bit of the header is cleared,
uncompress the data into an 8KiB buffer that <strong>MUST NOT</strong> overflow.</p>
</div>
<div class="paragraph">
<p>In the SquashFS archive format, metadata entries (e.g. inodes) are often
referenced using a 64 bit integer. The lower 16 bit hold an offset into the
uncompressed block and the upper 48 bit point to the on-disk location of the
block.</p>
</div>
<div class="paragraph">
<p>The on-disk location is relative to the type of metadata entry, e.g. for
inodes it is relative to the start of the inode table given by the
super block.</p>
</div>
</div>
<div class="sect2">
<h3 id="_storing_lookup_tables">2.3. Storing Lookup Tables</h3>
<div class="paragraph">
<p>Lookup tables are arrays (i.e. sequences of identical sized records) that are
addressed by an index.</p>
</div>
<div class="paragraph">
<p>Such tables are stored in the SquashFS format as metadata blocks, i.e. by
dividing the table data into 8KiB chunks that are separately compressed and
stored in sequence.</p>
</div>
<div class="paragraph">
<p>To allow constant time lookup, a list of 64 bit unsigned integers is stored,
holding the on-disk locations of each metadata block.</p>
</div>
<div class="paragraph">
<p>This list itself is stored uncompressed and not preceded by a header.</p>
</div>
<div class="paragraph">
<p>When referring to a lookup table, the superblock gives the number of table
entries and points to this location list.</p>
</div>
<div class="paragraph">
<p>Since the table entry size is a known, fixed value, the required number of
metadata blocks can be computed:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>block_count = ceil(table_count * entry_size / 8192)</pre>
</div>
</div>
<div class="paragraph">
<p>Which is also the number of 64 bit integers in the location list.</p>
</div>
<div class="paragraph">
<p>When resolving a lookup table index, first work out the index of the
metadata block:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>meta_index = floor(index * entry_size / 8192)</pre>
</div>
</div>
<div class="paragraph">
<p>Using this index on the location list yields the on-disk location of
the metadata block containing the entry.</p>
</div>
<div class="paragraph">
<p>After reading this metadata block, the byte offset into the block can
be computed to get the entry:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>offset = index * entry_size % 8192</pre>
</div>
</div>
<div class="paragraph">
<p>The location list can be cached in memory. Resolving an index requires at
worst a single metadata block read (at most 8194 bytes fetched from an
unaligned on-disk location).</p>
</div>
</div>
<div class="sect2">
<h3 id="_supported_compressors">2.4. Supported Compressors</h3>
<div class="paragraph">
<p>The SquashFS format supports the following compressors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>zlib deflate (referred to as "gzip" but only uses raw zlib streams)</p>
</li>
<li>
<p>lzo</p>
</li>
<li>
<p>lzma 1 (considered deprecated)</p>
</li>
<li>
<p>lzma 2 (referred to as "xz")</p>
</li>
<li>
<p>lz4</p>
</li>
<li>
<p>zstd</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archive can only specify one compressor in the super block and has to use
it for both file data and metadata compression. Using one compressor for data
and switching to a different compressor for e.g. inodes is not supported.</p>
</div>
<div class="paragraph">
<p>While it is technically not possible to pick a "null" compressor in the super
block, an implementation can still deliberately write only uncompressed blocks
to a SquashFS archive, or choose to store certain metadata blocks without
compression.</p>
</div>
<div class="paragraph">
<p>The lzma 2 aka xz compressor <strong>MUST</strong> use <code>CRC32</code> checksums only. Using <code>SHA-256</code> is
not supported.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_superblock">3. The Superblock</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The superblock is the first section of a SquashFS archive. It is always
96 bytes in size and contains important information about the archive,
including the locations of other sections.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 17.647%;">
<col style="width: 76.4707%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">magic</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Must be set to <code>0x73717368</code> ("hsqs" on disk).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inode count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of inodes stored in the archive.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod time</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Last modification time of the archive. Count seconds
                   since 00:00, Jan 1st 1970 UTC (not counting leap
                   seconds). This is unsigned, so it expires in the
                   year 2106 (as opposed to 2038).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The size of a data block in bytes. Must be a power
                     of two between 4096 (4k) and 1048576 (1 MiB).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frag count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of entries in the fragment table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compressor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An ID designating the compressor used for both data
                     and meta data blocks.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GZIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">just zlib streams (no gzip headers!)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LZMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LZMA version 1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LZO</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XZ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LZMA version 2 as used by xz-utils</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LZ4</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZSTD</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block log</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The log<sub>2</sub> of the block size. If the two fields do not
                    agree, the archive is considered corrupted.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Bit wise <strong>OR</strong> of the flag bits below.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inodes are stored uncompressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data blocks are stored uncompressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unused, should always be unset.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fragments are stored uncompressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fragments are not used.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0020</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fragments are always generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0040</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data has been deduplicated.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0080</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS export table exists.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xattrs are stored uncompressed.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0200</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There are no Xattrs in the archive.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0400</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compressor options are present.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0800</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID table is uncompressed.</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of entries in the ID lookup table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version major</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Major version of the format. Must be set to 4.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">version minor</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Minor version of the format. Must be set to 0.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root inode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A reference to the inode of the root directory.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytes used</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of bytes used by the archive. Because
                     SquashFS archives must be padded to a multiple of the underlying
                     device block size, this can be less than the actual file size.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the id table starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xattr table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the xattr id table starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inode table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the inode table starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dir. table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the directory table starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frag table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the fragment table starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Export table</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The byte offset at which the export table starts.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Xattr table, fragment table and export table are optional. If they are
omitted from the archive, the respective fields indicating their position
must be set to <code>0xFFFFFFFFFFFFFFFF</code> (i.e. all bits set).</p>
</div>
<div class="paragraph">
<p>Most of the flags only serve an informational purpose and are only useful
when editing the archive to convey the original packer settings.</p>
</div>
<div class="paragraph">
<p>The only flag that actually carries information is the "Compressor options are
present" flag. In fact, this is the only flag that the Linux kernel
implementation actually tests for.</p>
</div>
<div class="paragraph">
<p>The compressor options, however, are also only there for informal purpose, as
most compression libraries understand their own stream format irregardless of
the options used to compress and in fact don&#8217;t provide any options for the
decompressor. In the Linux kernel, the XZ decompressor is currently the only
one that processes those options to pre-allocate the LZMA dictionary if a
non-default size was used.</p>
</div>
<div class="sect2">
<h3 id="_compression_options">3.1. Compression Options</h3>
<div class="paragraph">
<p>If the compressor options flag is set in the superblock, the superblock is
immediately followed by a single metadata block, which is always uncompressed.</p>
</div>
<div class="paragraph">
<p>The data stored in this block is compressor dependent.</p>
</div>
<div class="paragraph">
<p>There are two special cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For LZ4, the compressor options always have to be present.</p>
</li>
<li>
<p>The LZMA compressor does not support compressor options, so this section
must never be present.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the compressors currently implemented, a 4 to 8 byte payload follows.</p>
</div>
<div class="paragraph">
<p>The following sub sections outline the contents for each compressor that
supports options. The default values if the options are missing are outlined
as well.</p>
</div>
<div class="sect3">
<h4 id="_gzip">3.1.1. GZIP</h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compression level</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the range 1 to 9 (inclusive). Defaults to 9.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">window size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In the rage 8 to 15 (inclusive). Defaults to 15.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strategies</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A bit field describing the enabled strategies.
                     If no flags are set, the default strategy is
                     implicitly used. Please consult the ZLIB manual
                     for details on specific strategies.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default strategy.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filtered.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Huffman Only.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run Length Encoded.</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed.</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The SquashFS writer typically tries all selected strategies (including
not setting any and letting zlib work with defaults) and stores the result
with the smallest size.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_xz">3.1.2. XZ</h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dictionary size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SHOULD</strong> be &gt;= 8KiB, and must be either a power of
                          2, or the sum of two consecutive powers of 2.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filters</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A bit field describing the additional enabled
                  filters attempted to better compress executable
                  code.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x86</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PowerPC</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IA64</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ARM thumb</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0020</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPARC</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A SquashFS writer typically tries all selected VLI filters (including
not setting any and letting libxz work with defaults) and stores the resulting
block that has the smallest size.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note that further options, such as XZ presets, are not included. The
compressor typically uses the libxz defaults, i.e. level 6 and not using the
extreme flag. Likewise for <code>lc</code>, <code>lp</code> and <code>pb</code> (defaults are 3, 0 and 2
respectively).</p>
</div>
<div class="paragraph">
<p>If the encoder chooses to change those values, the decoder will still be
able to read the data, but there is currently no way to convey that those
values were changed.</p>
</div>
<div class="paragraph">
<p>This is specifically problematic for the compression level, since increasing
the level can result in drastically increasing the decoders memory consumption.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lz4">3.1.3. LZ4</h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>MUST</strong> be set to 1.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A bit field describing the enabled LZ4 flags.
                 There is currently only one possible flag:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0x0001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use LZ4 High Compression(HC) mode.</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zstd">3.1.4. ZSTD</h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compression level</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Should be in range 1 to 22 (inclusive). The real
                            maximum is the zstd defined ZSTD_maxCLevel().
                           <br>
                           <br>
                            The default value is 15.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_lzo">3.1.5. LZO</h4>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">algorithm</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Which variant of LZO to use.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lzo1x_1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lzo1x_1_11</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lzo1x_1_12</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lzo1x_1_15</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lzo1x_999 (default)</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">compression level</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>For lzo1x_999, this can be a value between 0
                            and 9 inclusive (defaults to 8). <strong>MUST</strong> be 0
                            for all other algorithms.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_and_fragment_blocks">4. Data and Fragment Blocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in 2.1, file data is packed by dividing the input files into fixed
size chunks (the block size from the super block) that are stored in sequence.</p>
</div>
<div class="paragraph">
<p>The picture below tries to illustrate this concept:</p>
</div>
<div class="literalblock">
<div class="title">Packing of File Data</div>
<div class="content">
<pre class="nowrap">         _____ _____ _____ _             _____ _____ _              _
File A: |__A__|__A__|__A__|A|   File B: |__B__|__B__|B|    File C: |C|
           |     |     |   |               |     |   |              |
           | +---+     |   |               |     |   |              |
           | |  +------+   |               |     |   |              |
           | |  |          |               |     |   |              |
           | |  |   +------|---------------+     |   |              |
           | |  |   |   +--|---------------------+   |              |
           | |  |   |   |  |                         |              |
           | |  |   |   |  +-----------------------+ | +------------+
           | |  |   |   |                          | | |
           V V  V   V   V                          V V V
          __ _ ___ ___ ___ __     Fragment block: |A|B|C|
 Output: |_A|A|_A_|_B_|_B_|_F|                       |
                                                   __V__
                            A                     |__F__|
                            |                        |
                            +------------------------+</pre>
</div>
</div>
<div class="paragraph">
<p>In the above diagram, file A consists of 3 blocks and a single tail end, file B has
2 blocks and one tail end while file C is smaller than block size.</p>
</div>
<div class="paragraph">
<p>For each file, the blocks are individually compressed and stored on disk
in order.</p>
</div>
<div class="paragraph">
<p>The tail ends of A and B, together with the entire contents of C are packed
together into a fragment block F, that is compressed and stored on disk once
it is full.</p>
</div>
<div class="paragraph">
<p>This tail-end-packing is completely optional. The tail ends (or in case of C
the entire file) can also be treated as truncated blocks that expand to less
than block size when uncompressed.</p>
</div>
<div class="paragraph">
<p>There are no headers in front of data or fragment blocks and there <strong>MUST NOT</strong> be
any gaps between data blocks from a single file, but a SquashFS packer is free
to leave gaps between two different files or fragment blocks. The packer is
also free to decide how to arrange fragments within a fragment block and what
fragments to pack together.</p>
</div>
<div class="paragraph">
<p>To locate file data, the file inodes store the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The uncompressed size of the file. From this, the number of blocks can
be computed:</p>
<div class="literalblock">
<div class="content">
<pre>block_count = floor(file_size / block_size)   # if tail end packing is used
block_count = ceil(file_size / block_size)    # otherwise</pre>
</div>
</div>
</li>
<li>
<p>The exact location of the first block, if one exists.</p>
</li>
<li>
<p>For each consecutive block, the on-disk size.</p>
<div class="paragraph">
<p>A 32 bit integer is used with bit 24 (i.e. <code>1 &lt;&lt; 24</code>) set if the block
is stored uncompressed.</p>
</div>
</li>
<li>
<p>If tail-end-packing was done, the location of the fragment block and a
byte offset into the uncompressed fragment block. The size of the tail
end can be computed easily:</p>
<div class="literalblock">
<div class="content">
<pre>tail_end_size = file_size % block_size</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since a fragment block will likely be referred to by multiple files, inodes
don&#8217;t store its on-disk location and size directly, but instead use a 32 bit
index into a fragment block lookup table (see the <a href="#_fragment_table">Fragment Table</a>).</p>
</div>
<div class="paragraph">
<p>If a data block other than the last one unpacks to less than block size, the
rest of the buffer is filled with 0 bytes. This way, sparse files are
implemented. Specifically if a block has an on-disk size of 0 this translates
to an entire block filled with 0 bytes without having to retrieve any data
from disk.</p>
</div>
<div class="paragraph">
<p>The on-disk locations of file blocks <strong>MAY</strong> overlap and different file inodes are
free to refer to the same fragment. Typical SquashFS packers would explicitly
use this to for files that are duplicates of others. Doing so is NOT counted
as a hard link.</p>
</div>
<div class="paragraph">
<p>If an inode references on-disk locations outside the data area, the result is
undefined.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inode_table">5. Inode Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inodes are packed into metadata blocks and are not aligned, i.e. they can span
the boundary between metadata blocks. To save space, there are different
inodes for each type (regular file, directory, device, etc.) of varying
contents and size.</p>
</div>
<div class="paragraph">
<p>To further save more space, inodes come in two flavors: simple inode types
optimized for a simple, standard use case, and extended inode types where
extra information has to be stored.</p>
</div>
<div class="paragraph">
<p>SquashFS more or less supports 32 bit UIDs and GIDs. As an optimization, those
IDs are stored in a lookup table (see <a href="#_id_table">ID Table</a>) and the inodes themselves
hold a 16 bit index into this table. This allows to 32 bit UIDs/GIDs, but only
among 2<sup>16</sup> unique values.</p>
</div>
<div class="paragraph">
<p>The location of the first metadata block is indicated by the inode table start
in the superblock. The inode table ends at the start of the directory table.</p>
</div>
<div class="sect2">
<h3 id="_common_inode_header">5.1. Common Inode Header</h3>
<div class="paragraph">
<p>All Inodes share a common header, which contains some common information,
as well as describing the type of Inode which follows. This header has the
following structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The type of item described by the inode which follows this header</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Directory</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic File</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Symlink</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Block Device</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Character Device</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Named Pipe (FIFO)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Socked</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Directory</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended File</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Symlink</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Block Device</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Character Device</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Named Pipe (FIFO)</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extended Socked</p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">permissions</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A bit mask representing Unix file system permissions
                      for the inode. This only stores permissions, not the
                      type. The type is reconstructed from the field above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uid</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_id_table">ID Table</a>, giving the user ID of the owner.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gid</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_id_table">ID Table</a>, giving the group ID of the owner.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mtime</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The unsigned number of seconds (not counting leap
                seconds) since 00:00, Jan 1st, 1970 UTC when the item
                described by the inode was last modified.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inode number</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Unique node number. Must be at least 1 and at most
                       the inode count from the super block.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_directory_inodes">5.2. Directory Inodes</h3>
<div class="paragraph">
<p>Directory inodes mainly contain a reference into the directory table where
the listing of entries is stored.</p>
</div>
<div class="paragraph">
<p>A basic directory has an entry listing of at most 64k (uncompressed) and
no extended attributes. The layout of the inode data is as follows:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The location of the metadata block in the directory
                      table where the entry information starts. This is
                      relative to the directory table location.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of hard links to this directory.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Total (uncompressed) size in bytes of the entry
                    listing in the directory table, including headers.
                   <br>
                   <br>
                    This value is 3 bytes larger than the real listing.
                    The Linux kernel creates "." and ".." entries for
                    offsets 0 and 1, and only after 3 looks into the
                    listing, subtracting 3 from the size.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The (uncompressed) offset within the metadata block
                       in the directory table where the directory listing
                       starts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent inode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The inode number of the parent of this directory. If
                       this is the root directory, this <strong>SHOULD</strong> be 0.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For historical reasons, the hard link count of a directory includes
the number of entries in the directory and is initialized to 2 for an empty
directory. I.e. a directory with N entries has at least N + 2 link count.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the "file size" is set to a value &lt; 4, the directory is empty and there is
no corresponding listing in the directory table.</p>
</div>
<div class="paragraph">
<p>An extended directory can have a listing that is at most 4GiB in size, may
have extended attributes and can have an optional index for faster lookup:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parent inode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of directory index entries following the
                      inode structure.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_xattr_table">Xattr Table</a> or <code>0xFFFFFFFF</code>
                      if the inode has no extended attributes.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The index follows directly after the inode. See <a href="#_directory_index">Directory Index</a> for details on
how the directory index is structured.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_inodes">5.3. File Inodes</h3>
<div class="paragraph">
<p>Basic files can be at most 4 GiB in size (uncompressed), must be located
within the first 4 GiB of the SquashFS image, cannot have any extended
attributes and don&#8217;t support hard-link or sparse file accounting:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocks start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The offset from the start of the archive to the first
                       data block.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frag index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_fragment_table">Fragment Table</a> which describes the fragment
                     block that the tail end of this file is stored in. If not used,
                     this is set to <code>0xFFFFFFFF</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The (uncompressed) offset within the fragment block
                       where the tail end of this file is. See <a href="#_data_and_fragment_blocks">Data and Fragment Blocks</a>
                       for details.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The (uncompressed) size of this file.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block sizes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An array of consecutive block sizes. See <a href="#_data_and_fragment_blocks">Data and Fragment Blocks</a> for details.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If 'frag index' is set to <code>0xFFFFFFFF</code>, the number of blocks is computed as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ceil(file_size / block_size)</pre>
</div>
</div>
<div class="paragraph">
<p>otherwise, if 'frag index' is a valid fragment index, the block count is
computed as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>floor(file_size / block_size)</pre>
</div>
</div>
<div class="paragraph">
<p>and the size of the tail end is</p>
</div>
<div class="literalblock">
<div class="content">
<pre>file_size % block_size</pre>
</div>
</div>
<div class="paragraph">
<p>To access a data block, first compute the block index as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>index = floor(offset / block_size)</pre>
</div>
</div>
<div class="paragraph">
<p>then compute the on-disk location of the block by summing up the sizes of the
blocks that come before it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>location = block_start</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>for i = 0; i &lt; index; i++
    location += block_sizes[i] &amp; 0x00FFFFFF</pre>
</div>
</div>
<div class="paragraph">
<p>The tail end, if present, is accessed by resolving the fragment index through
the fragment lookup table (see the <a href="#_fragment_table">Fragment Table</a>), loading the fragment block and
using the given 'block offset' into the fragment block.</p>
</div>
<div class="paragraph">
<p>Extended files have a 64 bit location and size, have additional counters for
sparse file accounting and hard links, and can have extended attributes:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocks start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above (but larger).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above (but larger).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sparse</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of bytes saved by omitting zero bytes.
                 Used in the kernel for sparse file accounting.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of hard links to this node.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">frag index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_xattr_table">Xattr Table</a> or <code>0xFFFFFFFF</code>
                      if the inode has no extended attributes.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block sizes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_symbolic_links">5.4. Symbolic Links</h3>
<div class="paragraph">
<p>Symbolic links mainly have a target path stored directly after the inode
header, as well as a hard-link counter (yes, you can have hard links to
symlinks):</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of hard links to this symlink.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The size in bytes of the target path this symlink
                      points to.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target path</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An array of bytes holding the target path this
                       symlink points to. The path is 'target size' bytes
                       long and NOT null-terminated.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The extended symlink type adds an additional extended attribute index:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">target path</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_xattr_table">Xattr Table</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_device_special_files">5.5. Device Special Files</h3>
<div class="paragraph">
<p>Basic device special files only store a hard-link counter and a device number.
The layout is identical for both character and block devices:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of hard links to this entry.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">device number</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The system specific device number.
                       <br>
                       <br>
                        On Linux, this consists of major and minor device
                        numbers that can be extracted as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>major = (dev &amp; 0xFFF00) &gt;&gt; 8.
minor = (dev &amp; 0x000FF)</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The extended device file inode adds an additional extended attribute index:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">device number</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_xattr_table">Xattr Table</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_ipc_inodes_fifo_or_socket">5.6. IPC Inodes (FIFO or Socket)</h3>
<div class="paragraph">
<p>Named pipe (FIFO) and socket special files only add a hard-link counter
after the inode header:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of hard links to this entry.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The extended versions add an additional extended attribute index:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">link count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Same as above.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An index into the <a href="#_xattr_table">Xattr Table</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_directory_table">6. Directory Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each directory inode, the directory table stores a linear list of all
entries, with references back to the inodes that describe those entries.</p>
</div>
<div class="paragraph">
<p>The entry list itself is sorted ASCIIbetically by entry name and split into
multiple runs, each preceded by a short header.</p>
</div>
<div class="paragraph">
<p>The directory inodes store the total, uncompressed size of the entire listing,
including headers. Using this size, a SquashFS reader can determine if another
header with further entries should be following once it reaches the end of a
run.</p>
</div>
<div class="paragraph">
<p>To save space, the header indicates a metadata block and a reference inode
number. The entries that follow simply store a difference to that inode number
and an offset into the specified metadata block.</p>
</div>
<div class="paragraph">
<p>Every time, the inode block changes or the difference of the inode number
to the reference in the header cannot be encoded in 16 bits anymore, a new
header is emitted.</p>
</div>
<div class="paragraph">
<p>A header must be followed by <strong>AT MOST</strong> 256 entries. If there are more entries,
a new header <strong>MUST</strong> be emitted.</p>
</div>
<div class="paragraph">
<p>Typically, inode allocation strategies would sort the children of a directory
and then allocate inode numbers incrementally, to optimize directory entry
listings.</p>
</div>
<div class="paragraph">
<p>Since hard links might be further further away than 32k of the reference
number, they might require a new header to be emitted. Inode number allocation
and picking of the reference could of course be optimized to prevent this.</p>
</div>
<div class="paragraph">
<p>The directory header has the following structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Number of entries following the header.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The location of the metadata block in the inode table
                where the inodes are stored. This is relative to the
                inode table start from the super block.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inode number</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An arbitrary inode number. The entries that follow
                       store their inode number as a difference to this.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The counter is stored off-by-one, i.e. a value of 0 indicates 1 entry follows.
This also makes it impossible to encode a size of 0, which wouldn&#8217;t make any
sense. Empty directories simply have their size set to 0 in the inode instead,
so no extra dummy header has to be stored or looked up.</p>
</div>
<div class="paragraph">
<p>The header is followed by multiple entries that each have this structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An offset into the uncompressed inode metadata block.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inode offset</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The difference of this inode&#8217;s number to the reference
                       stored in the header.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The inode type. For extended inodes, the basic type is stored
               here instead.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>One less than the size of the entry name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The file name of the entry without a trailing null byte. Has
                <code>name size</code> + 1 bytes.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the entry structure itself, the file names are stored without trailing null
bytes. Since a zero length name makes no sense, the name length is stored
off-by-one, i.e. the value 0 cannot be encoded.</p>
</div>
<div class="paragraph">
<p>The inode type is stored in the entry, but always as the corresponding
basic type.</p>
</div>
<div class="paragraph">
<p>While the field is technically 16 bits, the kernel implementation currently
imposes an arbitrary limit of 255 on the name size field. Since the field is
off-by-one, this means that a file name in SquashFS can be at most 256
characters long.</p>
</div>
<div class="sect2">
<h3 id="_directory_index">6.1. Directory Index</h3>
<div class="paragraph">
<p>To speed up lookups on directories with lots of entries, the extended
directory inode can store an index, holding the locations of all directory
headers and the name of the first entry after the header.</p>
</div>
<div class="paragraph">
<p>When searching for an entry, the reader can then iterate over the index to
find a range of metadata blocks that should contain a given entry and then
only scan over the given range.</p>
</div>
<div class="paragraph">
<p>To allow for even faster lookups, a new header should be emitted every time
the entry list crosses a metadata block boundary. This narrows the boundary
down to a single metadata block lookup in most cases.</p>
</div>
<div class="paragraph">
<p>The index entries have the following structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This stores a byte offset from the first directory
                header to the current header, as if the uncompressed
                directory metadata blocks were laid out in memory
                consecutively.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Start offset of a directory table metadata block,
                relative to the directory table start.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>One less than the size of the entry name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the first entry following the header
                without a trailing null byte.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fragment_table">7. Fragment Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tail-ends and smaller than block size files can be combined into fragment
blocks that are at most 'block size' bytes long.</p>
</div>
<div class="paragraph">
<p>The fragment table describes the location and size of the fragment blocks
(not the tail-ends within them).</p>
</div>
<div class="paragraph">
<p>This is a lookup table which stores entries of the following shape:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The offset within the archive where the fragment block starts</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The on-disk size of the fragment block. If the block is
               uncompressed, bit 24 (i.e. <code>1 &lt;&lt; 24</code>) is set.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SHOULD</strong> be set to 0.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table is stored on-disk as described in <a href="#_storing_lookup_tables">Storing Lookup Tables</a>.</p>
</div>
<div class="paragraph">
<p>The fragment table location in the superblock points to an array of 64 bit
integers that store the on-disk locations of the metadata blocks containing
the lookup table.</p>
</div>
<div class="paragraph">
<p>Each metadata block can store up to 512 entries (<code>8192 / 16</code>).</p>
</div>
<div class="paragraph">
<p>The "unused" field is there for alignment and <strong>SHOULD</strong> be set to 0, however the
Linux kernel currently ignores this field completely, making it impossible for
Linux to ever re-purpose this field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_export_table">8. Export Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To support NFS exports, SquashFS needs a fast way to resolve an inode number
to an inode structure.</p>
</div>
<div class="paragraph">
<p>For this purpose, a SquashFS archive can optionally contain an export table,
which is basically a flat array of 64 bit inode references, with the inode
number being used as an index into the array.</p>
</div>
<div class="paragraph">
<p>Because the inode number 0 is not used (reserved as a sentinel value), the
array actually starts at inode number 1 and the index is thus
inode_number - 1.</p>
</div>
<div class="paragraph">
<p>The array itself is stored in a series of metadata blocks, as outlined in
<a href="#_storing_lookup_tables">Storing Lookup Tables</a>.</p>
</div>
<div class="paragraph">
<p>Since each block can store 1024 references (<code>8192 / 8</code>), there will be
<code>ceil(inode_count / 1024)</code> metadata blocks for the entire array.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_id_table">9. ID Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As outlined in <a href="#_common_inode_header">Common Inode Header</a>, SquashFS supports 32 bit user and group IDs. To
compact the inode table, the unique UID/GID values are collected in a lookup
table and a 16 bit table index is stored in the inode instead.</p>
</div>
<div class="paragraph">
<p>This lookup table is stored as outlined in <a href="#_storing_lookup_tables">Storing Lookup Tables</a>.</p>
</div>
<div class="paragraph">
<p>Each metadata block can store up to 2048 IDs (<code>8192 / 4</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_xattr_table">10. Extended Attribute Table</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Extended attributes are arbitrary key value pairs attached to inodes. The key
names use dots as separators to create a hierarchy of name spaces.</p>
</div>
<div class="paragraph">
<p>The key value pairs of all inodes are stored consecutively in a series of
metadata blocks.</p>
</div>
<div class="paragraph">
<p>The values can either be stored inline, i.e. a key entry is directly followed
by a value, or out-of-line to deduplicate identical values and use a reference
instead. Typically, the first occurrence of a value is stored in line and
every consecutive use of the same value uses an out-of-line reference back to
the first one.</p>
</div>
<div class="paragraph">
<p>The keys are stored using the following data structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A prefix ID for the key name. If the value that follows
               is stored out-of-line, the flag <code>0x0100</code> is <strong>OR</strong>ed to the
               type ID.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 90.9091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top">Value</th>
<th class="tableblock halign-left valign-top">Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix the name with <code>"user."</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix the name with <code>"trusted."</code></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefix the name with <code>"security."</code></p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of key bytes the follows.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The remainder of the key without the prefix and without a
                trailing null byte.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Following the key, this structure is used to store the value:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The size of the value string. If the value is stored
                     out of line, this is always 8, i.e. the size of an
                     unsigned 64 bit integer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u8[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This is 'value size' bytes of arbitrary binary data.
                 If the value is stored out-of-line, this is a 64 bit
                 reference, i.e. a location of a metadata block,
                 shifted left by 16 and <strong>OR</strong>ed with an offset into the
                 uncompressed block, giving the location of another
                 value structure.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The metadata block location given by an out-of-line reference is relative to
the location of the first block.</p>
</div>
<div class="paragraph">
<p>To actually address a block of key value pairs associated with an inode, a
lookup table is used that specifies the start and size of a sequence of key
value pairs.</p>
</div>
<div class="paragraph">
<p>All an inode needs to store is a 32 bit index into this table. If two inodes
have an identical attribute sets, the key/value sequence is only written once,
there is only one lookup table entry and both inodes have the same index.</p>
</div>
<div class="paragraph">
<p>Each lookup table entry has the following structure:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xattr ref</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A reference to the start of the key value block, i.e.
                    the metadata block location shifted left by 16, <strong>OR</strong>ed
                    with an offset into the uncompressed block.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of key value pairs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The exact, uncompressed size in bytes of the entire
               block of key value pairs, counting what has been
               written to disk and including the key/value entry
               structures.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This lookup table is stored as outlined in <a href="#_storing_lookup_tables">Storing Lookup Tables</a></p>
</div>
<div class="paragraph">
<p>Each metadata block can hold 512 (<code>8192 / 16</code>) entries.</p>
</div>
<div class="paragraph">
<p>However, in contrast to <a href="#_storing_lookup_tables">Storing Lookup Tables</a>, additional data is given before
the list of metadata block locations, to locate the key-value pairs, as well as the
actual number of lookup table entries that are not specified in the super
block.</p>
</div>
<div class="paragraph">
<p>The 'Xattr table' entry in the superblock gives the absolute location of the
following data structure which is stored on-disk as is, uncompressed:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 4%;">
<col style="width: 16%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">kv start</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The absolute position of the first metadata block holding the
                   key/value pairs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The number of entries in the lookup table.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>SHOULD</strong> be set to 0, however Linux currently ignores
                 this field completely and squashfs-tools used to leak
                 stack data here, making it impossible for Linux to
                 ever re-purpose this field.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u64[]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>An array holding the absolute on-disk location of each
                      metadata block of the lookup table.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If an inode has a a valid xattr index (i.e. not <code>0xFFFFFFFF</code>), the metadata
block index is computed as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>block_idx = floor(index / 512)</pre>
</div>
</div>
<div class="paragraph">
<p>which is then used to retrieve the metadata block index from the locations
array.</p>
</div>
<div class="paragraph">
<p>Once the block has been read from disk and uncompressed, the byte offset into
the metadata block can be computed as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>offset = (index * 16) % 8192</pre>
</div>
</div>
<div class="paragraph">
<p>From this position, the structure can be read that holds a reference to the
metadata block that contains the key/value pairs (and byte offset into the
uncompressed block where the pairs start), as well as the number of key/value
pairs and their total, uncompressed size.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-03-23 20:24:45 -0400
</div>
</div>
</body>
</html>